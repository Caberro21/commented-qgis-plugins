<html>
<head>
<meta charset="utf-8">
<title></title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
<script src="https://rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=desert&amp;lang=css" defer></script>
<body>
<pre class="prettyprint">
# -*- coding: utf-8 -*-
#
# (c) 2016 Boundless, http://boundlessgeo.com
# This code is licensed under the GPL 2.0 license.
#
import os
from qgis.PyQt.QtCore import <a href='http://geoapis.sourcepole.com/pyqt/qvariant'>QVariant</a>
from qgis.PyQt.QtGui import <a href='http://geoapis.sourcepole.com/pyqt/qicon'>QIcon</a>

try:
    from qgis.core import  <a href='http://geoapis.sourcepole.com/pyqt/qgis'>QGis</a>
except ImportError:
    from qgis.core import  Qgis as <a href='http://geoapis.sourcepole.com/pyqt/qgis'>QGis</a>

from qgis.core import <a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider'>QgsVectorDataProvider</a>, <a href='http://geoapis.sourcepole.com/qgispyapi/qgsfield'>QgsField</a>, <a href='http://geoapis.sourcepole.com/qgispyapi/qgscoordinatereferencesystem'>QgsCoordinateReferenceSystem</a>, <a href='http://geoapis.sourcepole.com/qgispyapi/qgscoordinatetransform'>QgsCoordinateTransform</a>

from processing.core.GeoAlgorithm import GeoAlgorithm
from processing.core.parameters import ParameterVector
from processing.core.outputs import OutputVector
from processing.tools import dataobjects, vector
from processing.core.GeoAlgorithmExecutionException import GeoAlgorithmExecutionException

from what3words.w3w import what3words
from qgiscommons.settings import pluginSetting

pluginPath = os.path.<a href="javascript://" data-toggle="popover" title="split" data-content="<ul><li><a href='http://geoapis.sourcepole.com/pyqt/qbytearray#split'>QByteArray.split()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qitemselection#split'>QItemSelection.split()</a></li></ul>">split</a>(os.path.dirname(__file__))[0]


class Add3WordsFieldAlgorithm(GeoAlgorithm):

    '''
    An algorithm that takes a points layer and oututs the same layer but with 
    an additional field containing w3w adresses of points in the input layer.
    '''

    INPUT = 'INPUT'
    OUTPUT = 'OUTPUT'

    def processAlgorithm(self, progress):
        '''
        Here is where the algorithm functionality takes places. This method is 
        called when the algorithm is executed'''

        apik = pluginSetting("apiKey")
        if apik is None or apik == ""::
            '''
            When there is a problem in a Processing algorithm, a 
            GeoAlgorithmExecutionException should be raised.
            '''
             raise GeoAlgorithmExecutionException("what3words API key is not defined")

        '''
        Get value selected by user. It will always be a string with the path 
        to the layer source.
        '''
        filename = self.getParameterValue(self.INPUT)
        
        '''Convert it to a QGIS layer object'''
        layer = dataobjects.getObjectFromUri(filename)
        
        '''Some checking'''
        provider = layer.<a href="javascript://" data-toggle="popover" title="dataProvider" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrasterlayer#QgsRasterLayer.dataProvider'>QgsRasterLayer.dataProvider()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayer#QgsVectorLayer.dataProvider'>QgsVectorLayer.dataProvider()</a></li></ul>">dataProvider</a>()
        caps = provider.<a href="javascript://" data-toggle="popover" title="capabilities" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsdataitem#QgsDataItem.capabilities'>QgsDataItem.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgssinglesymbolrendererv2#QgsSingleSymbolRendererV2.capabilities'>QgsSingleSymbolRendererV2.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscategorizedsymbolrendererv2#QgsCategorizedSymbolRendererV2.capabilities'>QgsCategorizedSymbolRendererV2.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrulebasedrendererv2#QgsRuleBasedRendererV2.capabilities'>QgsRuleBasedRendererV2.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointdisplacementrenderer#QgsPointDisplacementRenderer.capabilities'>QgsPointDisplacementRenderer.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrasterinterface#QgsRasterInterface.capabilities'>QgsRasterInterface.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeaturerendererv2#QgsFeatureRendererV2.capabilities'>QgsFeatureRendererV2.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgraduatedsymbolrendererv2#QgsGraduatedSymbolRendererV2.capabilities'>QgsGraduatedSymbolRendererV2.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsdataitemprovider#QgsDataItemProvider.capabilities'>QgsDataItemProvider.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.capabilities'>QgsVectorDataProvider.capabilities()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsinvertedpolygonrenderer#QgsInvertedPolygonRenderer.capabilities'>QgsInvertedPolygonRenderer.capabilities()</a></li></ul>">capabilities</a>()
        if not (caps & <a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider'>QgsVectorDataProvider</a>.AddAttributes):
            raise GeoAlgorithmExecutionException("The selected layer does not support adding new attributes.")

        '''
        Check if there is a field named '3WordAddr'. If it exists already, 
        we will overwrite its content. Otherwise, we create a new one.
        '''
        idxField = layer.<a href="javascript://" data-toggle="popover" title="fieldNameIndex" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeature#QgsFeature.fieldNameIndex'>QgsFeature.fieldNameIndex()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfields#QgsFields.fieldNameIndex'>QgsFields.fieldNameIndex()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.fieldNameIndex'>QgsVectorDataProvider.fieldNameIndex()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayer#QgsVectorLayer.fieldNameIndex'>QgsVectorLayer.fieldNameIndex()</a></li></ul>">fieldNameIndex</a>("3WordAddr")
        if idxField == -1:
            provider.<a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.addAttributes'>addAttributes</a>([<a href='http://geoapis.sourcepole.com/qgispyapi/qgsfield'>QgsField</a>("3WordAddr", <a href='http://geoapis.sourcepole.com/pyqt/qvariant'>QVariant</a>.String, "", 254, 0)])
            layer.<a href="javascript://" data-toggle="popover" title="updateFields" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayereditbuffer#QgsVectorLayerEditBuffer.updateFields'>QgsVectorLayerEditBuffer.updateFields()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsexpressionfieldbuffer#QgsExpressionFieldBuffer.updateFields'>QgsExpressionFieldBuffer.updateFields()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayereditpassthrough#QgsVectorLayerEditPassthrough.updateFields'>QgsVectorLayerEditPassthrough.updateFields()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayerjoinbuffer#QgsVectorLayerJoinBuffer.updateFields'>QgsVectorLayerJoinBuffer.updateFields()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayer#QgsVectorLayer.updateFields'>QgsVectorLayer.updateFields()</a></li></ul>">updateFields</a>()
            idxField = layer.<a href="javascript://" data-toggle="popover" title="fieldNameIndex" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeature#QgsFeature.fieldNameIndex'>QgsFeature.fieldNameIndex()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfields#QgsFields.fieldNameIndex'>QgsFields.fieldNameIndex()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.fieldNameIndex'>QgsVectorDataProvider.fieldNameIndex()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayer#QgsVectorLayer.fieldNameIndex'>QgsVectorLayer.fieldNameIndex()</a></li></ul>">fieldNameIndex</a>("3WordAddr")

        w3w = what3words(apikey=apik)

        nFeat = layer.<a href="javascript://" data-toggle="popover" title="featureCount" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.featureCount'>QgsVectorDataProvider.featureCount()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayer#QgsVectorLayer.featureCount'>QgsVectorLayer.featureCount()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsdualview#QgsDualView.featureCount'>QgsDualView.featureCount()</a></li></ul>">featureCount</a>()
        epsg4326 = <a href='http://geoapis.sourcepole.com/qgispyapi/qgscoordinatereferencesystem'>QgsCoordinateReferenceSystem</a>("EPSG:4326")

        '''
        We use this object to convert point coords from the layer CRS into 
        EPSG:4326, which is needed to call the w3w service
        '''
        transform = <a href='http://geoapis.sourcepole.com/qgispyapi/qgscoordinatetransform'>QgsCoordinateTransform</a>(layer.<a href="javascript://" data-toggle="popover" title="crs" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermapgrid#QgsComposerMapGrid.crs'>QgsComposerMapGrid.crs()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsdataprovider#QgsDataProvider.crs'>QgsDataProvider.crs()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeaturestore#QgsFeatureStore.crs'>QgsFeatureStore.crs()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgml#QgsGml.crs'>QgsGml.crs()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsmaplayer#QgsMapLayer.crs'>QgsMapLayer.crs()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsnewmemorylayerdialog#QgsNewMemoryLayerDialog.crs'>QgsNewMemoryLayerDialog.crs()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsprojectionselectionwidget#QgsProjectionSelectionWidget.crs'>QgsProjectionSelectionWidget.crs()</a></li></ul>">crs</a>(), epsg4326)

        '''Iterate over features'''
        for i, feat in enumerate(layer.<a href="javascript://" data-toggle="popover" title="getFeatures" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsabstractfeaturesource#QgsAbstractFeatureSource.getFeatures'>QgsAbstractFeatureSource.getFeatures()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayercache#QgsVectorLayerCache.getFeatures'>QgsVectorLayerCache.getFeatures()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgml#QgsGml.getFeatures'>QgsGml.getFeatures()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.getFeatures'>QgsVectorDataProvider.getFeatures()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayer#QgsVectorLayer.getFeatures'>QgsVectorLayer.getFeatures()</a></li></ul>">getFeatures</a>()):
            progress.setPercentage(int(100 * i / nFeat))
            '''Get Coordinate in layer CRS'''
            pt = feat.<a href="javascript://" data-toggle="popover" title="geometry" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeature#QgsFeature.geometry'>QgsFeature.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrendercontext#QgsRenderContext.geometry'>QgsRenderContext.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometry#QgsGeometry.geometry'>QgsGeometry.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometrycache#QgsGeometryCache.geometry'>QgsGeometryCache.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometryrubberband#QgsGeometryRubberBand.geometry'>QgsGeometryRubberBand.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qspaceritem#geometry'>QSpacerItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qsystemtrayicon#geometry'>QSystemTrayIcon.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#geometry'>QWidget.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidgetitem#geometry'>QWidgetItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qlayout#geometry'>QLayout.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qlayoutitem#geometry'>QLayoutItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicslayoutitem#geometry'>QGraphicsLayoutItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qspaceritem#geometry'>QSpacerItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qlayoutitem#geometry'>QLayoutItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qsystemtrayicon#geometry'>QSystemTrayIcon.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicslayoutitem#geometry'>QGraphicsLayoutItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidgetitem#geometry'>QWidgetItem.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qlayout#geometry'>QLayout.geometry()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#geometry'>QWidget.geometry()</a></li></ul>">geometry</a>().<a href="javascript://" data-toggle="popover" title="vertexAt" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsabstractgeometryv2#QgsAbstractGeometryV2.vertexAt'>QgsAbstractGeometryV2.vertexAt()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometrycollectionv2#QgsGeometryCollectionV2.vertexAt'>QgsGeometryCollectionV2.vertexAt()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscurvev2#QgsCurveV2.vertexAt'>QgsCurveV2.vertexAt()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometry#QgsGeometry.vertexAt'>QgsGeometry.vertexAt()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscurvepolygonv2#QgsCurvePolygonV2.vertexAt'>QgsCurvePolygonV2.vertexAt()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointv2#QgsPointV2.vertexAt'>QgsPointV2.vertexAt()</a></li></ul>">vertexAt</a>(0)
            try:
                '''Convert to 4326'''
                pt4326 = transform.<a href="javascript://" data-toggle="popover" title="transform" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsabstractgeometryv2#QgsAbstractGeometryV2.transform'>QgsAbstractGeometryV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsmaptopixel#QgsMapToPixel.transform'>QgsMapToPixel.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometrycollectionv2#QgsGeometryCollectionV2.transform'>QgsGeometryCollectionV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscoordinatetransformcache#QgsCoordinateTransformCache.transform'>QgsCoordinateTransformCache.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscircularstringv2#QgsCircularStringV2.transform'>QgsCircularStringV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgslinestringv2#QgsLineStringV2.transform'>QgsLineStringV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsgeometry#QgsGeometry.transform'>QgsGeometry.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscoordinatetransform#QgsCoordinateTransform.transform'>QgsCoordinateTransform.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscompoundcurvev2#QgsCompoundCurveV2.transform'>QgsCompoundCurveV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscurvepolygonv2#QgsCurvePolygonV2.transform'>QgsCurvePolygonV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointv2#QgsPointV2.transform'>QgsPointV2.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsview#transform'>QGraphicsView.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpaintenginestate#transform'>QPaintEngineState.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpainter#transform'>QPainter.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qbrush#transform'>QBrush.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#transform'>QGraphicsItem.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsview#transform'>QGraphicsView.transform()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#transform'>QGraphicsItem.transform()</a></li></ul>">transform</a>(pt.<a href="javascript://" data-toggle="popover" title="x" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspoint#QgsPoint.x'>QgsPoint.x()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvector#QgsVector.x'>QgsVector.x()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointv2#QgsPointV2.x'>QgsPointV2.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpoint#x'>QPoint.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpointf#x'>QPointF.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrectf#x'>QRectF.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrect#x'>QRect.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector2d#x'>QVector2D.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qmouseevent#x'>QMouseEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtabletevent#x'>QTabletEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qquaternion#x'>QQuaternion.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qcontextmenuevent#x'>QContextMenuEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#x'>QWidget.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector3d#x'>QVector3D.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwheelevent#x'>QWheelEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextline#x'>QTextLine.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector4d#x'>QVector4D.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qhelpevent#x'>QHelpEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#x'>QGraphicsItem.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#x'>QGraphicsItem.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#x'>QWidget.x()</a></li></ul>">x</a>(), pt.<a href="javascript://" data-toggle="popover" title="y" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspoint#QgsPoint.y'>QgsPoint.y()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvector#QgsVector.y'>QgsVector.y()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointv2#QgsPointV2.y'>QgsPointV2.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpoint#y'>QPoint.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpointf#y'>QPointF.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrectf#y'>QRectF.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrect#y'>QRect.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector2d#y'>QVector2D.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qmouseevent#y'>QMouseEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtabletevent#y'>QTabletEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qquaternion#y'>QQuaternion.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qcontextmenuevent#y'>QContextMenuEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#y'>QWidget.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector3d#y'>QVector3D.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwheelevent#y'>QWheelEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextline#y'>QTextLine.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector4d#y'>QVector4D.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qhelpevent#y'>QHelpEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#y'>QGraphicsItem.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#y'>QGraphicsItem.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#y'>QWidget.y()</a></li></ul>">y</a>())
                '''Convert 4326 coord into w3w address'''
                threeWords = w3w.reverseGeocode(pt4326.<a href="javascript://" data-toggle="popover" title="y" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspoint#QgsPoint.y'>QgsPoint.y()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvector#QgsVector.y'>QgsVector.y()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointv2#QgsPointV2.y'>QgsPointV2.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpoint#y'>QPoint.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpointf#y'>QPointF.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrectf#y'>QRectF.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrect#y'>QRect.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector2d#y'>QVector2D.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qmouseevent#y'>QMouseEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtabletevent#y'>QTabletEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qquaternion#y'>QQuaternion.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qcontextmenuevent#y'>QContextMenuEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#y'>QWidget.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector3d#y'>QVector3D.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwheelevent#y'>QWheelEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextline#y'>QTextLine.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector4d#y'>QVector4D.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qhelpevent#y'>QHelpEvent.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#y'>QGraphicsItem.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#y'>QGraphicsItem.y()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#y'>QWidget.y()</a></li></ul>">y</a>(), pt4326.<a href="javascript://" data-toggle="popover" title="x" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspoint#QgsPoint.x'>QgsPoint.x()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvector#QgsVector.x'>QgsVector.x()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgspointv2#QgsPointV2.x'>QgsPointV2.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpoint#x'>QPoint.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpointf#x'>QPointF.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrectf#x'>QRectF.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qrect#x'>QRect.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector2d#x'>QVector2D.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qmouseevent#x'>QMouseEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtabletevent#x'>QTabletEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qquaternion#x'>QQuaternion.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qcontextmenuevent#x'>QContextMenuEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#x'>QWidget.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector3d#x'>QVector3D.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwheelevent#x'>QWheelEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextline#x'>QTextLine.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qvector4d#x'>QVector4D.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qhelpevent#x'>QHelpEvent.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#x'>QGraphicsItem.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qgraphicsitem#x'>QGraphicsItem.x()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qwidget#x'>QWidget.x()</a></li></ul>">x</a>())["words"]
            except Exception as e:
                progress.setDebugInfo("Failed to retrieve w3w address for feature {}:\n{}".<a href="javascript://" data-toggle="popover" title="format" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrendererrangev2labelformat#QgsRendererRangeV2LabelFormat.format'>QgsRendererRangeV2LabelFormat.format()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrasteridentifyresult#QgsRasterIdentifyResult.format'>QgsRasterIdentifyResult.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qsettings#format'>QSettings.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qsyntaxhighlighter#format'>QSyntaxHighlighter.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qimagereader#format'>QImageReader.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtexttablecell#format'>QTextTableCell.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qmimesource#format'>QMimeSource.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qimage#format'>QImage.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qprogressbar#format'>QProgressBar.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextobject#format'>QTextObject.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qmovie#format'>QMovie.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextlist#format'>QTextList.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qpictureio#format'>QPictureIO.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qimageiohandler#format'>QImageIOHandler.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qimagewriter#format'>QImageWriter.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextinlineobject#format'>QTextInlineObject.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qabstracttextdocumentlayout#format'>QAbstractTextDocumentLayout.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qdropevent#format'>QDropEvent.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtextdocumentwriter#format'>QTextDocumentWriter.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qtexttable#format'>QTextTable.format()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qprogressbar#format'>QProgressBar.format()</a></li></ul>">format</a>(feat.<a href="javascript://" data-toggle="popover" title="id" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermap#QgsComposerMap.id'>QgsComposerMap.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayerundocommand#QgsVectorLayerUndoCommand.id'>QgsVectorLayerUndoCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeature#QgsFeature.id'>QgsFeature.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrelation#QgsRelation.id'>QgsRelation.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermergecommand#QgsComposerMergeCommand.id'>QgsComposerMergeCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposeritem#QgsComposerItem.id'>QgsComposerItem.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsauthmethodconfig#QgsAuthMethodConfig.id'>QgsAuthMethodConfig.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsmaplayer#QgsMapLayer.id'>QgsMapLayer.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermapitem#QgsComposerMapItem.id'>QgsComposerMapItem.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermultiframemergecommand#QgsComposerMultiFrameMergeCommand.id'>QgsComposerMultiFrameMergeCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayerundocommandchangegeometry#QgsVectorLayerUndoCommandChangeGeometry.id'>QgsVectorLayerUndoCommandChangeGeometry.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgslayertreeembeddedwidgetprovider#QgsLayerTreeEmbeddedWidgetProvider.id'>QgsLayerTreeEmbeddedWidgetProvider.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qshortcut#id'>QShortcut.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qbuttongroup#id'>QButtonGroup.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qundocommand#id'>QUndoCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qbuttongroup#id'>QButtonGroup.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qshortcut#id'>QShortcut.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qundocommand#id'>QUndoCommand.id()</a></li></ul>">id</a>(), str(e)))
                threeWords = ""

            provider.<a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectordataprovider#QgsVectorDataProvider.changeAttributeValues'>changeAttributeValues</a>({feat.<a href="javascript://" data-toggle="popover" title="id" data-content="<ul><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermap#QgsComposerMap.id'>QgsComposerMap.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayerundocommand#QgsVectorLayerUndoCommand.id'>QgsVectorLayerUndoCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsfeature#QgsFeature.id'>QgsFeature.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsrelation#QgsRelation.id'>QgsRelation.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermergecommand#QgsComposerMergeCommand.id'>QgsComposerMergeCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposeritem#QgsComposerItem.id'>QgsComposerItem.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsauthmethodconfig#QgsAuthMethodConfig.id'>QgsAuthMethodConfig.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsmaplayer#QgsMapLayer.id'>QgsMapLayer.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermapitem#QgsComposerMapItem.id'>QgsComposerMapItem.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgscomposermultiframemergecommand#QgsComposerMultiFrameMergeCommand.id'>QgsComposerMultiFrameMergeCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgsvectorlayerundocommandchangegeometry#QgsVectorLayerUndoCommandChangeGeometry.id'>QgsVectorLayerUndoCommandChangeGeometry.id()</a></li><li><a href='http://geoapis.sourcepole.com/qgispyapi/qgslayertreeembeddedwidgetprovider#QgsLayerTreeEmbeddedWidgetProvider.id'>QgsLayerTreeEmbeddedWidgetProvider.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qshortcut#id'>QShortcut.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qbuttongroup#id'>QButtonGroup.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qundocommand#id'>QUndoCommand.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qbuttongroup#id'>QButtonGroup.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qshortcut#id'>QShortcut.id()</a></li><li><a href='http://geoapis.sourcepole.com/pyqt/qundocommand#id'>QUndoCommand.id()</a></li></ul>">id</a>() : {idxField: threeWords}})

        self.setOutputValue(self.OUTPUT, filename)

    def defineCharacteristics(self):

        '''The syntax of the algorithm is defined here'''

        self.name = 'Add 3 word address field to points layer'
        self.i18n_name = self.name
        self.group = 'what3words tools'
        self.i18n_group = self.group

        '''
        The algorithm rquires just one parameter: the layer to which w3w 
        adresses will be added
        '''
        Only one parameter 
        self.addParameter(ParameterVector(self.INPUT,
                                          'Input layer', [ParameterVector.VECTOR_TYPE_POINT]))

        self.addOutput(OutputVector(self.OUTPUT, 'Output', True))

    def getIcon(self):
        return <a href='http://geoapis.sourcepole.com/pyqt/qicon'>QIcon</a>(os.path.join(pluginPath, "icons", "w3w.png"))

</pre>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover({html:true}); 
});
</script>
</body>